---
title: CDN原理极其工作机制笔记
date: 2017-05-31 21:48:40
tags:
- CDN
---

CDN就是`内容分布网络`（Content Delivery Network）。目的是通过现有的internet中增加一层新的网络架构，将网站的内容发布到离用户最近的网络"边缘"。提高用户获得网站访问速度的提升。CDN=Mirror+Cache+GSLB(整体的负载均衡)。
<!--more-->
## CDN的内容和目标

CDN目前主要是用来缓存网站的一些静态文件为主。如CSS\images\js、静态页面等。
### 目标
* 可扩展性，性能可扩展、成本可扩展。
* 安全性，减少因为DDoS攻击和其他攻击导致一个节点业务中断
* 可靠性、响应和执行。通过负载均衡及时的提供网络的容错机制。

## CDN的访问步骤

![步骤图](http://pic001.cnblogs.com/images/2011/1/2011111514091332.jpg)
* 1、用户在浏览器中输入要访问的域名；
* 2、浏览器向域名解析服务器发出解析请求，由于CDN对域名解析过程进行了调整，所以用户端一般得到的是该域名对应的CNAME记录，此时浏览器需要再次对获得的CNAME域名进行解析才能得到缓存服务器实际的IP地址； 注：在此过程中，全局负载均衡DNS解析服务器会根据用户端的源IP地址，如地理位置（深圳还是上海）、接入网类型（电信还是网通）将用户的访问请求定位到离用户路由最短、位置最近、负载最轻的Cache节点（缓存服务器）上，实现就近定位。定位优先原则可按位置、可按路由、也可按负载等。
* 3、再次解析后浏览器得到该域名CDN缓存服务器的实际IP地址，向缓存服务器发出访问请求；
* 4、缓存服务器根据浏览器提供的域名，通过Cache内部专用DNS解析得到此域名源服务器的真实IP地址，再由缓存服务器向此真实IP地址提交访问请求；
*  5、缓存服务器从真实IP地址得到内容后，一方面在本地进行保存，以备以后使用，同时把得到的数据发送到客户端浏览器，完成访问的响应过程；
* 6、用户端得到由缓存服务器传回的数据后显示出来，至此完成整个域名访问过程；

## 负载均衡
通常负载均衡有三种结构
* 链路负载均衡
* 集群负载均衡
* 操作系统负载均衡

### 链路负载均衡
(1)链路负载均衡设备 接收内网用户流量

(2)链路负载均衡设备根据根据目的IP来查找目的IP所属运营商

(3)链路负载均衡设备根据选定的运营商结果将流量转发给选定的链路

(4) 链路负载均衡设备接收外网用户流量

(5)链路负载均衡设备将流量转发给内网用户

### 集群负载均衡
* 硬件负载均衡 性能好，单点服务器实现去实现负载均衡
* 软件负载均衡（nginx反向代理） 成本低，请求要经过多次代理服务器，增加网络延时。

### 操作系统负载均衡
利用操作系统级别的软中断或者硬件中断来达到负载均衡。

## CDN数据同步
复制，缓存，CDN服务器可以在用户请求后缓存文件，也可以主动抓取主服务器内容。
![](http://ww2.sinaimg.cn/mw690/5e4d414cgw1er7cizt3znj20dw099756.jpg)
## CDN动态加速
通过DNS解析通过动态的链路探测来寻找回源最好的一条路径。通过DNS调度找到CND节点最近的提供服务。
